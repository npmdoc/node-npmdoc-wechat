<html><head></head><body><div class="apidocDiv">
<style>
/*csslint
*/
.apidocDiv {
    background: #fff;
    font-family: Arial, Helvetica, sans-serif;
}
.apidocDiv a[href] {
    color: #33f;
    font-weight: bold;
    text-decoration: none;
}
.apidocDiv a[href]:hover {
    text-decoration: underline;
}
.apidocCodeCommentSpan {
    background: #bbf;
    color: #000;
    display: block;
}
.apidocCodeKeywordSpan {
    color: #d00;
    font-weight: bold;
}
.apidocCodePre {
    background: #eef;
    border: 1px solid;
    color: #777;
    padding: 5px;
    white-space: pre-wrap;
}
.apidocFooterDiv {
    margin-top: 20px;
    text-align: center;
}
.apidocModuleLi {
    margin-top: 10px;
}
.apidocSectionDiv {
    border-top: 1px solid;
    margin-top: 20px;
}
.apidocSignatureSpan {
    color: #777;
    font-weight: bold;
}
</style>
<h1>api documentation for
    <a href="https://github.com/node-webot/wechat#readme">wechat (v2.1.0)</a>
</h1>
<h4>å¾®ä¿¡å…¬å…±å¹³å°Nodeåº“</h4>
<div class="apidocSectionDiv"><a href="#apidoc.tableOfContents" id="apidoc.tableOfContents"><h1>table of contents</h1></a><ol>

    <li class="apidocModuleLi"><a href="#apidoc.module.wechat">module wechat</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.wechat.Event">
            function <span class="apidocSignatureSpan">wechat.</span>Event
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.wechat.List">
            function <span class="apidocSignatureSpan">wechat.</span>List
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.wechat.checkSignature">
            function <span class="apidocSignatureSpan">wechat.</span>checkSignature
            <span class="apidocSignatureSpan">(query, token)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.wechat.event">
            function <span class="apidocSignatureSpan">wechat.</span>event
            <span class="apidocSignatureSpan">(fn)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.wechat.image">
            function <span class="apidocSignatureSpan">wechat.</span>image
            <span class="apidocSignatureSpan">(fn)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.wechat.link">
            function <span class="apidocSignatureSpan">wechat.</span>link
            <span class="apidocSignatureSpan">(fn)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.wechat.location">
            function <span class="apidocSignatureSpan">wechat.</span>location
            <span class="apidocSignatureSpan">(fn)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.wechat.reply">
            function <span class="apidocSignatureSpan">wechat.</span>reply
            <span class="apidocSignatureSpan">(content, fromUsername, toUsername, message)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.wechat.reply2CustomerService">
            function <span class="apidocSignatureSpan">wechat.</span>reply2CustomerService
            <span class="apidocSignatureSpan">(fromUsername, toUsername, kfAccount)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.wechat.session">
            function <span class="apidocSignatureSpan">wechat.</span>session
            <span class="apidocSignatureSpan">(id, req, data)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.wechat.shortvideo">
            function <span class="apidocSignatureSpan">wechat.</span>shortvideo
            <span class="apidocSignatureSpan">(fn)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.wechat.text">
            function <span class="apidocSignatureSpan">wechat.</span>text
            <span class="apidocSignatureSpan">(fn)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.wechat.toXML">
            function <span class="apidocSignatureSpan">wechat.</span>toXML
            <span class="apidocSignatureSpan">(data)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.wechat.video">
            function <span class="apidocSignatureSpan">wechat.</span>video
            <span class="apidocSignatureSpan">(fn)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.wechat.voice">
            function <span class="apidocSignatureSpan">wechat.</span>voice
            <span class="apidocSignatureSpan">(fn)</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">wechat.</span>Event.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">wechat.</span>List.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">wechat.</span>session.prototype</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.wechat.Event">module wechat.Event</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.wechat.Event.Event">
            function <span class="apidocSignatureSpan">wechat.</span>Event
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.wechat.Event.dispatch">
            function <span class="apidocSignatureSpan">wechat.Event.</span>dispatch
            <span class="apidocSignatureSpan">(event)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.wechat.Event.prototype">module wechat.Event.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.wechat.Event.prototype._dispatch">
            function <span class="apidocSignatureSpan">wechat.Event.prototype.</span>_dispatch
            <span class="apidocSignatureSpan">(message, req, res, next)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.wechat.Event.prototype.add">
            function <span class="apidocSignatureSpan">wechat.Event.prototype.</span>add
            <span class="apidocSignatureSpan">(event, callback)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.wechat.List">module wechat.List</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.wechat.List.List">
            function <span class="apidocSignatureSpan">wechat.</span>List
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.wechat.List.add">
            function <span class="apidocSignatureSpan">wechat.List.</span>add
            <span class="apidocSignatureSpan">(name, items, head, delimiter, foot)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.wechat.List.clear">
            function <span class="apidocSignatureSpan">wechat.List.</span>clear
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.wechat.List.get">
            function <span class="apidocSignatureSpan">wechat.List.</span>get
            <span class="apidocSignatureSpan">(name)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.wechat.List.prototype">module wechat.List.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.wechat.List.prototype.get">
            function <span class="apidocSignatureSpan">wechat.List.prototype.</span>get
            <span class="apidocSignatureSpan">(key)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.wechat.session">module wechat.session</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.wechat.session.session">
            function <span class="apidocSignatureSpan">wechat.</span>session
            <span class="apidocSignatureSpan">(id, req, data)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.wechat.session.prototype">module wechat.session.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.wechat.session.prototype.destroy">
            function <span class="apidocSignatureSpan">wechat.session.prototype.</span>destroy
            <span class="apidocSignatureSpan">(callback)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.wechat.session.prototype.save">
            function <span class="apidocSignatureSpan">wechat.session.prototype.</span>save
            <span class="apidocSignatureSpan">(callback)</span>
            </a>

        </li>

    </ol></li>

</ol></div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.wechat" id="apidoc.module.wechat">module wechat</a></h1>


    <h2>
        <a href="#apidoc.element.wechat.Event" id="apidoc.element.wechat.Event">
        function <span class="apidocSignatureSpan">wechat.</span>Event
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">Event = function () {
  this.events = {};
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.wechat.List" id="apidoc.element.wechat.List">
        function <span class="apidocSignatureSpan">wechat.</span>List
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">List = function () {
  this.map = {};
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.wechat.checkSignature" id="apidoc.element.wechat.checkSignature">
        function <span class="apidocSignatureSpan">wechat.</span>checkSignature
        <span class="apidocSignatureSpan">(query, token)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">checkSignature = function (query, token) {
  var signature = query.signature;
  var timestamp = query.timestamp;
  var nonce = query.nonce;

  var shasum = crypto.createHash('sha1');
  var arr = [token, timestamp, nonce].sort();
  shasum.update(arr.join(''));

  return shasum.digest('hex') === signature;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.wechat.event" id="apidoc.element.wechat.event">
        function <span class="apidocSignatureSpan">wechat.</span>event
        <span class="apidocSignatureSpan">(fn)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">event = function (fn) {
  return (new Handler())[method](fn);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
// FromUserName: 'oPKu7jgOibOA-De4u8J2RuNKpZRw',
// CreateTime: '1359125022',
// MsgType: 'link',
// Title: 'å…¬ä¼—å¹³å°å®˜ç½‘é“¾æŽ¥',
// Description: 'å…¬ä¼—å¹³å°å®˜ç½‘é“¾æŽ¥',
// Url: 'http://1024.com/',
// MsgId: '5837397520665436492' }
}).<span class="apidocCodeKeywordSpan">event</span>(function (message, req, res, next) {
// messageä¸ºäº‹ä»¶å†…å®¹
// { ToUserName: 'gh_d3e07d51b513',
// FromUserName: 'oPKu7jgOibOA-De4u8J2RuNKpZRw',
// CreateTime: '1359125022',
// MsgType: 'event',
// Event: 'LOCATION',
// Latitude: '23.137466',
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.wechat.image" id="apidoc.element.wechat.image">
        function <span class="apidocSignatureSpan">wechat.</span>image
        <span class="apidocSignatureSpan">(fn)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">image = function (fn) {
  return (new Handler())[method](fn);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
// messageä¸ºæ–‡æœ¬å†…å®¹
// { ToUserName: 'gh_d3e07d51b513',
// FromUserName: 'oPKu7jgOibOA-De4u8J2RuNKpZRw',
// CreateTime: '1359125035',
// MsgType: 'text',
// Content: 'http',
// MsgId: '5837397576500011341' }
}).<span class="apidocCodeKeywordSpan">image</span>(function (message, req, res, next) {
// messageä¸ºå›¾ç‰‡å†…å®¹
// { ToUserName: 'gh_d3e07d51b513',
// FromUserName: 'oPKu7jgOibOA-De4u8J2RuNKpZRw',
// CreateTime: '1359124971',
// MsgType: 'image',
// PicUrl: 'http://mmsns.qpic.cn/mmsns/bfc815ygvIWcaaZlEXJV7NzhmA3Y2fc4eBOxLjpPI60Q1Q6ibYicwg/0',
// MediaId: 'media_id',
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.wechat.link" id="apidoc.element.wechat.link">
        function <span class="apidocSignatureSpan">wechat.</span>link
        <span class="apidocSignatureSpan">(fn)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">link = function (fn) {
  return (new Handler())[method](fn);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
// CreateTime: '1359125311',
// MsgType: 'location',
// Location_X: '30.283950',
// Location_Y: '120.063139',
// Scale: '15',
// Label: {},
// MsgId: '5837398761910985062' }
}).<span class="apidocCodeKeywordSpan">link</span>(function (message, req, res, next) {
// messageä¸ºé“¾æŽ¥å†…å®¹
// { ToUserName: 'gh_d3e07d51b513',
// FromUserName: 'oPKu7jgOibOA-De4u8J2RuNKpZRw',
// CreateTime: '1359125022',
// MsgType: 'link',
// Title: 'å…¬ä¼—å¹³å°å®˜ç½‘é“¾æŽ¥',
// Description: 'å…¬ä¼—å¹³å°å®˜ç½‘é“¾æŽ¥',
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.wechat.location" id="apidoc.element.wechat.location">
        function <span class="apidocSignatureSpan">wechat.</span>location
        <span class="apidocSignatureSpan">(fn)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">location = function (fn) {
  return (new Handler())[method](fn);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
// { ToUserName: 'gh_d3e07d51b513',
// FromUserName: 'oPKu7jgOibOA-De4u8J2RuNKpZRw',
// CreateTime: '1359125022',
// MsgType: 'shortvideo',
// MediaId: 'OMYnpghh8fRfzHL8obuboDN9rmLig4s0xdpoNT6a5BoFZWufbE6srbCKc_bxduzS',
// ThumbMediaId: 'media_id',
// MsgId: '5837397520665436492' }
}).<span class="apidocCodeKeywordSpan">location</span>(function (message, req, res, next) {
// messageä¸ºä½ç½®å†…å®¹
// { ToUserName: 'gh_d3e07d51b513',
// FromUserName: 'oPKu7jgOibOA-De4u8J2RuNKpZRw',
// CreateTime: '1359125311',
// MsgType: 'location',
// Location_X: '30.283950',
// Location_Y: '120.063139',
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.wechat.reply" id="apidoc.element.wechat.reply">
        function <span class="apidocSignatureSpan">wechat.</span>reply
        <span class="apidocSignatureSpan">(content, fromUsername, toUsername, message)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">reply = function (content, fromUsername, toUsername, message) {
  var info = {};
  var type = 'text';
  info.content = content || '';
  info.createTime = new Date().getTime();
  if (message &amp;&amp; (message.MsgType === 'device_text' || message.MsgType === 'device_event')) {
    info.DeviceType = message.DeviceType;
    info.DeviceID = message.DeviceID;
    info.SessionID = isNaN(message.SessionID) ? 0 : message.SessionID;
    info.createTime = Math.floor(info.createTime / 1000);
    if (message['Event'] === 'subscribe_status' || message['Event'] === 'unsubscribe_status') {
      delete info.content;
      info.DeviceStatus = isNaN(content) ? 0 : content;
    } else {
      if (!(content instanceof Buffer)) {
        content = String(content);
      }
      info.content = new Buffer(content).toString('base64');
    }
    type = message.MsgType;
    if (message.MsgType === 'device_event') {
      info['Event'] = message['Event'];
    }
  } else if (Array.isArray(content)) {
    type = 'news';
  } else if (typeof content === 'object') {
    if (content.hasOwnProperty('type')) {
      type = content.type;
      if (content.content) {
        info.content = content.content;
      }
      if (content.HardWare) {
        info.HardWare = content.HardWare;
      }
    } else {
      type = 'music';
    }
  }
  info.msgType = type;
  info.toUsername = toUsername;
  info.fromUsername = fromUsername;
  return compiled(info);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

app.use(express.query());
app.use('/wechat', wechat(config, function (req, res, next) {
// å¾®ä¿¡è¾“å…¥ä¿¡æ¯éƒ½åœ¨req.weixinä¸Š
var message = req.weixin;
if (message.FromUserName === 'diaosi') {
  // å›žå¤å±Œä¸(æ™®é€šå›žå¤)
  res.<span class="apidocCodeKeywordSpan">reply</span>('hehe');
} else if (message.FromUserName === 'text') {
  //ä½&nbsp;ä¹Ÿå¯ä»¥è¿™æ&nbsp;·å›žå¤textç±»åž‹çš„ä¿¡æ¯
  res.reply({
    content: 'text object',
    type: 'text'
  });
} else if (message.FromUserName === 'hehe') {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.wechat.reply2CustomerService" id="apidoc.element.wechat.reply2CustomerService">
        function <span class="apidocSignatureSpan">wechat.</span>reply2CustomerService
        <span class="apidocSignatureSpan">(fromUsername, toUsername, kfAccount)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">reply2CustomerService = function (fromUsername, toUsername, kfAccount) {
  var info = {};
  info.msgType = 'transfer_customer_service';
  info.createTime = new Date().getTime();
  info.toUsername = toUsername;
  info.fromUsername = fromUsername;
  info.content = {};
  if (typeof kfAccount === 'string') {
    info.content.kfAccount = kfAccount;
  }
  return compiled(info);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.wechat.session" id="apidoc.element.wechat.session">
        function <span class="apidocSignatureSpan">wechat.</span>session
        <span class="apidocSignatureSpan">(id, req, data)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">session = function (id, req, data) {
  Object.defineProperty(this, 'id', { value: id });
  Object.defineProperty(this, 'req', { value: req });
  if (data) {
    for (var key in data) {
      this[key] = data[key];
    }
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
OAuthåŠŸèƒ½è¯·å‰å¾€ï¼š&lt;https://github.com/node-webot/wechat-oauth&gt;

### WXSessionæ”¯æŒ
ç”±äºŽå…¬å…±å¹³å°åº”ç”¨çš„å®¢æˆ·ç«¯å®žé™…ä¸Šæ˜¯å¾®ä¿¡ï¼Œæ‰€ä»¥é‡‡ç”¨ä¼&nbsp;ç»Ÿçš„Cookieæ¥å®žçŽ°ä¼šè¯å¹¶ä¸çŽ°å®žï¼Œä¸ºæ­¤ä¸­é—´ä»¶æ¨¡å—åœ¨openidçš„åŸºç¡€ä¸Šæ·»åŠ&nbsp;äº†Sessionæ”¯æŒã€‚ä¸€æ—¦æœåŠ¡ç«¯å¯ç”¨äº†`connect.session`ä¸­é—´ä»¶ï¼Œåœ¨ä¸šåŠ¡ä¸­å°±å¯ä»¥è®¿é—®`req.wxsession`å±žæ€§ã€‚è¿™ä¸ªå±žæ€§ä¸Ž`
req.session`è¡Œä¸ºç±»ä¼¼ã€‚

```js
app.use(connect.cookieParser());
app.use(connect.<span class="apidocCodeKeywordSpan">session</span>({secret: 'keyboard cat', cookie: {maxAge: 60000}}));
app.use('/wechat', wechat('some token', wechat.text(function (info, req, res, next) {
if (info.Content === '=') {
  var exp = req.wxsession.text.join('');
  req.wxsession.text = '';
  res.reply(exp);
} else {
  req.wxsession.text = req.wxsession.text || [];
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.wechat.shortvideo" id="apidoc.element.wechat.shortvideo">
        function <span class="apidocSignatureSpan">wechat.</span>shortvideo
        <span class="apidocSignatureSpan">(fn)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">shortvideo = function (fn) {
  return (new Handler())[method](fn);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
// { ToUserName: 'gh_d3e07d51b513',
// FromUserName: 'oPKu7jgOibOA-De4u8J2RuNKpZRw',
// CreateTime: '1359125022',
// MsgType: 'video',
// MediaId: 'OMYnpghh8fRfzHL8obuboDN9rmLig4s0xdpoNT6a5BoFZWufbE6srbCKc_bxduzS',
// ThumbMediaId: 'media_id',
// MsgId: '5837397520665436492' }
}).<span class="apidocCodeKeywordSpan">shortvideo</span>(function (message, req, res, next) {
// messageä¸ºçŸ­è§†é¢‘å†…å®¹
// { ToUserName: 'gh_d3e07d51b513',
// FromUserName: 'oPKu7jgOibOA-De4u8J2RuNKpZRw',
// CreateTime: '1359125022',
// MsgType: 'shortvideo',
// MediaId: 'OMYnpghh8fRfzHL8obuboDN9rmLig4s0xdpoNT6a5BoFZWufbE6srbCKc_bxduzS',
// ThumbMediaId: 'media_id',
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.wechat.text" id="apidoc.element.wechat.text">
        function <span class="apidocSignatureSpan">wechat.</span>text
        <span class="apidocSignatureSpan">(fn)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">text = function (fn) {
  return (new Handler())[method](fn);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

### WXSessionæ”¯æŒ
ç”±äºŽå…¬å…±å¹³å°åº”ç”¨çš„å®¢æˆ·ç«¯å®žé™…ä¸Šæ˜¯å¾®ä¿¡ï¼Œæ‰€ä»¥é‡‡ç”¨ä¼&nbsp;ç»Ÿçš„Cookieæ¥å®žçŽ°ä¼šè¯å¹¶ä¸çŽ°å®žï¼Œä¸ºæ­¤ä¸­é—´ä»¶æ¨¡å—åœ¨openidçš„åŸºç¡€ä¸Šæ·»åŠ&nbsp;äº†Sessionæ”¯æŒã€‚ä¸€æ—¦æœåŠ¡ç«¯å¯ç”¨äº†`connect.session`ä¸­é—´ä»¶ï¼Œåœ¨ä¸šåŠ¡ä¸­å°±å¯ä»¥è®¿é—®`req.wxsession`å±žæ€§ã€‚è¿™ä¸ªå±žæ€§ä¸Ž`
req.session`è¡Œä¸ºç±»ä¼¼ã€‚

```js
app.use(connect.cookieParser());
app.use(connect.session({secret: 'keyboard cat', cookie: {maxAge: 60000}}));
app.use('/wechat', wechat('some token', wechat.<span class="apidocCodeKeywordSpan">text</span>(function (info
, req, res, next) {
if (info.Content === '=') {
  var exp = req.wxsession.text.join('');
  req.wxsession.text = '';
  res.reply(exp);
} else {
  req.wxsession.text = req.wxsession.text || [];
  req.wxsession.text.push(info.Content);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.wechat.toXML" id="apidoc.element.wechat.toXML">
        function <span class="apidocSignatureSpan">wechat.</span>toXML
        <span class="apidocSignatureSpan">(data)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">toXML = function (data) {
  var include = function (path, includeData) {
    var d = utils.shallowCopy({}, data);
    if (includeData) {
      d = utils.shallowCopy(d, includeData);
    }
    return includeFile(path, opts)(d);
  };
  return fn.apply(opts.context, [data || {}, escapeFn, include, rethrow]);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.wechat.video" id="apidoc.element.wechat.video">
        function <span class="apidocSignatureSpan">wechat.</span>video
        <span class="apidocSignatureSpan">(fn)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">video = function (fn) {
  return (new Handler())[method](fn);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
// { ToUserName: 'gh_d3e07d51b513',
// FromUserName: 'oPKu7jgOibOA-De4u8J2RuNKpZRw',
// CreateTime: '1359125022',
// MsgType: 'voice',
// MediaId: 'OMYnpghh8fRfzHL8obuboDN9rmLig4s0xdpoNT6a5BoFZWufbE6srbCKc_bxduzS',
// Format: 'amr',
// MsgId: '5837397520665436492' }
}).<span class="apidocCodeKeywordSpan">video</span>(function (message, req, res, next) {
// messageä¸ºè§†é¢‘å†…å®¹
// { ToUserName: 'gh_d3e07d51b513',
// FromUserName: 'oPKu7jgOibOA-De4u8J2RuNKpZRw',
// CreateTime: '1359125022',
// MsgType: 'video',
// MediaId: 'OMYnpghh8fRfzHL8obuboDN9rmLig4s0xdpoNT6a5BoFZWufbE6srbCKc_bxduzS',
// ThumbMediaId: 'media_id',
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.wechat.voice" id="apidoc.element.wechat.voice">
        function <span class="apidocSignatureSpan">wechat.</span>voice
        <span class="apidocSignatureSpan">(fn)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">voice = function (fn) {
  return (new Handler())[method](fn);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
// { ToUserName: 'gh_d3e07d51b513',
// FromUserName: 'oPKu7jgOibOA-De4u8J2RuNKpZRw',
// CreateTime: '1359124971',
// MsgType: 'image',
// PicUrl: 'http://mmsns.qpic.cn/mmsns/bfc815ygvIWcaaZlEXJV7NzhmA3Y2fc4eBOxLjpPI60Q1Q6ibYicwg/0',
// MediaId: 'media_id',
// MsgId: '5837397301622104395' }
}).<span class="apidocCodeKeywordSpan">voice</span>(function (message, req, res, next) {
// messageä¸ºéŸ³é¢‘å†…å®¹
// { ToUserName: 'gh_d3e07d51b513',
// FromUserName: 'oPKu7jgOibOA-De4u8J2RuNKpZRw',
// CreateTime: '1359125022',
// MsgType: 'voice',
// MediaId: 'OMYnpghh8fRfzHL8obuboDN9rmLig4s0xdpoNT6a5BoFZWufbE6srbCKc_bxduzS',
// Format: 'amr',
...</pre></li>
    </ul>








</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.wechat.Event" id="apidoc.module.wechat.Event">module wechat.Event</a></h1>


    <h2>
        <a href="#apidoc.element.wechat.Event.Event" id="apidoc.element.wechat.Event.Event">
        function <span class="apidocSignatureSpan">wechat.</span>Event
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">Event = function () {
  this.events = {};
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.wechat.Event.dispatch" id="apidoc.element.wechat.Event.dispatch">
        function <span class="apidocSignatureSpan">wechat.Event.</span>dispatch
        <span class="apidocSignatureSpan">(event)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">dispatch = function (event) {
  return function (message, req, res, next) {
    // messageä¸ºäº‹ä»¶å†…å®¹
    // { ToUserName: 'gh_d3e07d51b513',
    // FromUserName: 'oPKu7jgOibOA-De4u8J2RuNKpZRw',
    // CreateTime: '1359125022',
    // MsgType: 'event',
    // Event: 'LOCATION',
    // Latitude: '23.137466',
    // Longitude: '113.352425',
    // Precision: '119.385040',
    // MsgId: '5837397520665436492' }
    event._dispatch(message, req, res, next);
  };
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.wechat.Event.prototype" id="apidoc.module.wechat.Event.prototype">module wechat.Event.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.wechat.Event.prototype._dispatch" id="apidoc.element.wechat.Event.prototype._dispatch">
        function <span class="apidocSignatureSpan">wechat.Event.prototype.</span>_dispatch
        <span class="apidocSignatureSpan">(message, req, res, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_dispatch = function (message, req, res, next) {
  if (this.events[message.Event]) {
    this.events[message.Event](message, req, res, next);
  } else {
    next();
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.wechat.Event.prototype.add" id="apidoc.element.wechat.Event.prototype.add">
        function <span class="apidocSignatureSpan">wechat.Event.prototype.</span>add
        <span class="apidocSignatureSpan">(event, callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">add = function (event, callback) {
  this.events[event] = callback;
  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
`req.wxsession`ä¸Ž`req.session`é‡‡ç”¨ç›¸åŒçš„å­˜å‚¨å¼•æ“Žï¼Œè¿™æ„å‘³ç€å¦‚æžœé‡‡ç”¨redisä½œä¸ºå­˜å‚¨ï¼Œè¿™æ&nbsp;·`wxsession`å¯ä»¥å®žçŽ°è·¨è¿›ç¨‹å…±äº«ã€‚

### ç­‰å¾…å›žå¤
ç­‰å¾…å›žå¤ï¼Œç±»ä¼¼äºŽç”µè¯æ‹¨å·ä¸šåŠ¡ã€‚è¯¥åŠŸèƒ½åœ¨WXSessionçš„åŸºç¡€ä¸Šæä¾›ã€‚éœ€è¦ä¸ºç­‰å¾…å›žå¤é¢„ç½®æ“ä½œï¼Œä¸­é—´ä»¶å°†å…¶æŠ½è±¡ä¸º`List`å¯¹è±¡ï¼Œåœ¨æä¾›æœåŠ¡å‰éœ€è¦æ·»åŠ&nbsp;æœåŠ¡ã€‚

```js
var List = require('wechat').List;
List.<span class="apidocCodeKeywordSpan">add</span>('view', [
['å›žå¤{a}æŸ¥çœ‹æˆ‘çš„æ€§åˆ«', function (info, req, res) {
  res.reply('æˆ‘æ˜¯ä¸ªå¦¹çº¸å“Ÿ');
}],
['å›žå¤{b}æŸ¥çœ‹æˆ‘çš„å¹´é¾„', function (info, req, res) {
  res.reply('æˆ‘ä»Šå¹´18å²');
}],
['å›žå¤{c}æŸ¥çœ‹æˆ‘çš„æ€§å–å‘', 'è¿™æ&nbsp;·çš„äº‹æƒ…æ€Žä¹ˆå¥½æ„æ€å‘Šè¯‰ä½&nbsp;å•¦- -']
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.wechat.List" id="apidoc.module.wechat.List">module wechat.List</a></h1>


    <h2>
        <a href="#apidoc.element.wechat.List.List" id="apidoc.element.wechat.List.List">
        function <span class="apidocSignatureSpan">wechat.</span>List
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">List = function () {
  this.map = {};
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.wechat.List.add" id="apidoc.element.wechat.List.add">
        function <span class="apidocSignatureSpan">wechat.List.</span>add
        <span class="apidocSignatureSpan">(name, items, head, delimiter, foot)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">add = function (name, items, head, delimiter, foot) {
  var description = [];
  var list = new List();
  list.name = name;
  items.forEach(function (item) {
    var text = item[0];
    // æŠ½å–å‡ºkeyï¼Œå¹¶å…³è”ä¸Šå¯¹åº”çš„handle
    var replaced = text.replace(/\{(.*)\}/, function (match, key) {
      list.map[key] = item[1];
      return key;
    });
    description.push(replaced);
  });

  if (delimiter) {
    var lists = description.join('\n' + delimiter + '\n');
    list.description = util.format('%s\n%s\n%s', head || '', lists, (foot || ''));
  } else {
    list.description = description.join('\n');
  }
  listCache[name] = list;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
`req.wxsession`ä¸Ž`req.session`é‡‡ç”¨ç›¸åŒçš„å­˜å‚¨å¼•æ“Žï¼Œè¿™æ„å‘³ç€å¦‚æžœé‡‡ç”¨redisä½œä¸ºå­˜å‚¨ï¼Œè¿™æ&nbsp;·`wxsession`å¯ä»¥å®žçŽ°è·¨è¿›ç¨‹å…±äº«ã€‚

### ç­‰å¾…å›žå¤
ç­‰å¾…å›žå¤ï¼Œç±»ä¼¼äºŽç”µè¯æ‹¨å·ä¸šåŠ¡ã€‚è¯¥åŠŸèƒ½åœ¨WXSessionçš„åŸºç¡€ä¸Šæä¾›ã€‚éœ€è¦ä¸ºç­‰å¾…å›žå¤é¢„ç½®æ“ä½œï¼Œä¸­é—´ä»¶å°†å…¶æŠ½è±¡ä¸º`List`å¯¹è±¡ï¼Œåœ¨æä¾›æœåŠ¡å‰éœ€è¦æ·»åŠ&nbsp;æœåŠ¡ã€‚

```js
var List = require('wechat').List;
List.<span class="apidocCodeKeywordSpan">add</span>('view', [
['å›žå¤{a}æŸ¥çœ‹æˆ‘çš„æ€§åˆ«', function (info, req, res) {
  res.reply('æˆ‘æ˜¯ä¸ªå¦¹çº¸å“Ÿ');
}],
['å›žå¤{b}æŸ¥çœ‹æˆ‘çš„å¹´é¾„', function (info, req, res) {
  res.reply('æˆ‘ä»Šå¹´18å²');
}],
['å›žå¤{c}æŸ¥çœ‹æˆ‘çš„æ€§å–å‘', 'è¿™æ&nbsp;·çš„äº‹æƒ…æ€Žä¹ˆå¥½æ„æ€å‘Šè¯‰ä½&nbsp;å•¦- -']
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.wechat.List.clear" id="apidoc.element.wechat.List.clear">
        function <span class="apidocSignatureSpan">wechat.List.</span>clear
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">clear = function () {
  listCache = {};
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.wechat.List.get" id="apidoc.element.wechat.List.get">
        function <span class="apidocSignatureSpan">wechat.List.</span>get
        <span class="apidocSignatureSpan">(name)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">get = function (name) {
  return listCache[name];
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.wechat.List.prototype" id="apidoc.module.wechat.List.prototype">module wechat.List.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.wechat.List.prototype.get" id="apidoc.element.wechat.List.prototype.get">
        function <span class="apidocSignatureSpan">wechat.List.prototype.</span>get
        <span class="apidocSignatureSpan">(key)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">get = function (key) {
  return this.map[key];
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.wechat.session" id="apidoc.module.wechat.session">module wechat.session</a></h1>


    <h2>
        <a href="#apidoc.element.wechat.session.session" id="apidoc.element.wechat.session.session">
        function <span class="apidocSignatureSpan">wechat.</span>session
        <span class="apidocSignatureSpan">(id, req, data)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">session = function (id, req, data) {
  Object.defineProperty(this, 'id', { value: id });
  Object.defineProperty(this, 'req', { value: req });
  if (data) {
    for (var key in data) {
      this[key] = data[key];
    }
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
OAuthåŠŸèƒ½è¯·å‰å¾€ï¼š&lt;https://github.com/node-webot/wechat-oauth&gt;

### WXSessionæ”¯æŒ
ç”±äºŽå…¬å…±å¹³å°åº”ç”¨çš„å®¢æˆ·ç«¯å®žé™…ä¸Šæ˜¯å¾®ä¿¡ï¼Œæ‰€ä»¥é‡‡ç”¨ä¼&nbsp;ç»Ÿçš„Cookieæ¥å®žçŽ°ä¼šè¯å¹¶ä¸çŽ°å®žï¼Œä¸ºæ­¤ä¸­é—´ä»¶æ¨¡å—åœ¨openidçš„åŸºç¡€ä¸Šæ·»åŠ&nbsp;äº†Sessionæ”¯æŒã€‚ä¸€æ—¦æœåŠ¡ç«¯å¯ç”¨äº†`connect.session`ä¸­é—´ä»¶ï¼Œåœ¨ä¸šåŠ¡ä¸­å°±å¯ä»¥è®¿é—®`req.wxsession`å±žæ€§ã€‚è¿™ä¸ªå±žæ€§ä¸Ž`
req.session`è¡Œä¸ºç±»ä¼¼ã€‚

```js
app.use(connect.cookieParser());
app.use(connect.<span class="apidocCodeKeywordSpan">session</span>({secret: 'keyboard cat', cookie: {maxAge: 60000}}));
app.use('/wechat', wechat('some token', wechat.text(function (info, req, res, next) {
if (info.Content === '=') {
  var exp = req.wxsession.text.join('');
  req.wxsession.text = '';
  res.reply(exp);
} else {
  req.wxsession.text = req.wxsession.text || [];
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.wechat.session.prototype" id="apidoc.module.wechat.session.prototype">module wechat.session.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.wechat.session.prototype.destroy" id="apidoc.element.wechat.session.prototype.destroy">
        function <span class="apidocSignatureSpan">wechat.session.prototype.</span>destroy
        <span class="apidocSignatureSpan">(callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">destroy = function (callback) {
  delete this.req.wxsession;
  this.req.sessionStore.destroy(this.id, callback);
  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
 * Callback:
 *
 * - `err`, é”™è¯¯å¯¹è±¡ï¼Œåˆ&nbsp;é™¤å‘ç”Ÿé”™è¯¯æ—¶ä¼&nbsp;å…¥
 * @param {Function} callback ä»Žå­˜å‚¨ä¸­åˆ&nbsp;é™¤Sessionæ•°æ®åŽçš„å›žè°ƒå‡½æ•°
 */
Session.prototype.destroy = function (callback) {
  delete this.req.wxsession;
  this.req.sessionStore.<span class="apidocCodeKeywordSpan">destroy</span>(this.id, callback);
  return this;
};

module.exports = Session;
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.wechat.session.prototype.save" id="apidoc.element.wechat.session.prototype.save">
        function <span class="apidocSignatureSpan">wechat.session.prototype.</span>save
        <span class="apidocSignatureSpan">(callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">save = function (callback) {
  this.req.sessionStore.set(this.id, this, callback || function(){});
  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocFooterDiv">
    [ this document was created with
    <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a>
    ]
</div>
</div>
</body></html>